<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Delivery Page</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Common Header with Inline CSS -->
<header style="background-color:#333; padding:10px 0;">
  <nav>
    <ul style="list-style:none; margin:0; padding:0; display:flex; justify-content:center;">
      <li style="margin:0 15px;">
        <a href="index.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Home</a>
      </li>
      <li style="margin:0 15px;">
        <a href="discount.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Discounts</a>
      </li>
      <li style="margin:0 15px;">
        <a href="delivery.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Delivery</a>
      </li>
      <li style="margin:0 15px;">
        <a href="addToCart.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Cart</a>
      </li>
      <li style="margin:0 15px;">
        <a href="payment.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Payment</a>
      </li>
      <li style="margin:0 15px;">
        <a href="signin.html" style="text-decoration:none; color:white; font-weight:bold; transition:color 0.3s;">Sign In</a>
      </li>
    </ul>
  </nav>
</header>
  <style>
    #map {
      height: 300px;
      width: 100%;
    }
    .back-btn {
      display: inline-block;
      padding: 12px 24px;
      background-color: #0078D4;
      color: white;
      text-decoration: none;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      box-shadow: 0 0 10px #0078D4, 0 0 20px #0078D4;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .back-btn:hover {
      box-shadow: 0 0 15px #00aaff, 0 0 30px #00aaff;
      transform: scale(1.05);
    }
  </style>
</head>
    <!-- Back to Payment Button -->
<div class="text-center mt-3">
  <a href="payment.html" class="btn btn-outline-primary btn-sm me-2" title="Back to Payment">
    <i class="bi bi-arrow-left-circle"></i> Payment
  </a>
  <a href="addToCart.html" class="btn btn-outline-secondary btn-sm" title="Back to Cart">
    <i class="bi bi-cart"></i> Cart
  </a>
</div>

<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-4 text-center">Delivery Details</h2>
    <div class="row g-4">
      <!-- Address Form -->
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Customer Address</h5>
          <form id="addressForm">
            <input type="text" class="form-control mb-2" id="name" placeholder="Full Name" required />
            <input type="tel" class="form-control mb-2" id="phone" placeholder="Phone Number" required />
            <textarea class="form-control mb-2" id="address" placeholder="Full Address" rows="3" required></textarea>
            <button type="submit" class="btn btn-primary w-100">Show on Map</button>
          </form>
        </div>
      </div>

      <!-- Billing Summary -->
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Billing Summary</h5>
          <ul class="list-group mb-3" id="billingList"></ul>
        </div>
      </div>
    </div>

    <!-- Map Section -->
    <div class="card mt-4 p-3">
      <h5>Delivery Location</h5>
      <div id="map"></div>
    </div>


  </div>

  <!-- Bootstrap + Google Maps + JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwZyY9kP89ByL_Jt9L4ThC0odxAljE4u8&loading=asyncs" async defer></script>
  <script>
    let map;
    let marker;

    function initMap(lat = 25.4358, lng = 81.8463) {
      const location = { lat, lng };
      map = new google.maps.Map(document.getElementById("map"), {
        center: location,
        zoom: 14,
      });

      // Use AdvancedMarkerElement if available
      if (google.maps.marker && google.maps.marker.AdvancedMarkerElement) {
        marker = new google.maps.marker.AdvancedMarkerElement({
          position: location,
          map: map,
          title: "Delivery Location"
        });
      } else {
        marker = new google.maps.Marker({
          position: location,
          map: map,
          title: "Delivery Location"
        });
      }
    }

    document.getElementById("addressForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const address = document.getElementById("address").value;
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ address }, function (results, status) {
        if (status === "OK") {
          const loc = results[0].geometry.location;
          map.setCenter(loc);

          if (marker) marker.setMap(null);

          if (google.maps.marker && google.maps.marker.AdvancedMarkerElement) {
            marker = new google.maps.marker.AdvancedMarkerElement({
              map: map,
              position: loc,
              title: "Customer Address"
            });
          } else {
            marker = new google.maps.Marker({
              map: map,
              position: loc,
              title: "Customer Address"
            });
          }
        } else {
          alert("Geocode was not successful: " + status);
        }
      });
    });

    function loadBillingSummary() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const list = document.getElementById("billingList");
      list.innerHTML = "";

      if (!cart.length) {
        list.innerHTML = `<li class="list-group-item text-center text-muted">No items in cart</li>`;
        return;
      }

      let subtotal = 0;

      cart.forEach(item => {
        subtotal += item.price;
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between";
        li.innerHTML = `<span>${item.name}</span><strong>₹${item.price}</strong>`;
        list.appendChild(li);
      });

      const gst = Math.round(subtotal * 0.18);
      const total = subtotal + gst;

      list.innerHTML += `
        <li class="list-group-item d-flex justify-content-between">
          <span>Subtotal</span><strong>₹${subtotal}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>GST (18%)</span><strong>₹${gst}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total</span><strong>₹${total}</strong>
        </li>
      `;
    }

    window.addEventListener("load", () => {
      try {
        initMap();
      } catch (e) {
        console.warn("Map failed to load:", e);
      }
      loadBillingSummary();
    });
  </script>
</body>
</html>
